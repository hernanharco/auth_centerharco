# ============================================
# ðŸ§± DOCKER COMPOSE BASE
# Este archivo define los servicios comunes
# (backend, frontend, docs, storybook)
# pero sin detalles de entorno (ni puertos, ni volÃºmenes).
# Luego se combina con:
#   - docker-compose.dev.yml â†’ para desarrollo
#   - docker-compose.prod.yml â†’ para producciÃ³n
# ============================================

services:
  # ============================
  # ðŸš€ BACKEND (NestJS)
  # ============================
  backend:    
    build:
      context: ./backend # Carpeta donde estÃ¡ el cÃ³digo del backend
      # No se especifica Dockerfile â†’ usa "Dockerfile" por defecto
    container_name: backend_auth
    env_file:
      - ./backend/.env # Variables de entorno
    working_dir: /usr/src/app # Directorio de trabajo dentro del contenedor
    restart: unless-stopped # Reinicia si el contenedor se detiene inesperadamente

  # ============================
  # ðŸ’» FRONTEND (Vite / Next.js)
  # ============================
  frontend:    
    build:
      context: ./frontend
      # Por defecto usa Dockerfile (producciÃ³n)
    container_name: frontend_auth
    environment:
      - VITE_API_URL=http://backend:3000 # Desde navegador hacia host    
    restart: unless-stopped

  # ============================
  # ðŸ“˜ DOCUMENTACIÃ“N (VitePress)
  # ============================
  docs:
    build:
      context: ./docs
    container_name: docs_auth
    restart: always # Reinicia siempre (servicio estable)

  # ============================
  # ðŸ§© STORYBOOK (componentes UI)
  # ============================
  storybook:
    build:
      context: ./storybook 
    container_name: storybook_auth
    volumes:
      - ./storybook:/app       # monta toda la carpeta del proyecto Storybook
      - ./frontend:/app/frontend        # monta el cÃ³digo del frontend
      - /app/node_modules      # evita conflictos de dependencias
    environment:
      - NODE_ENV=development
    restart: always      
  # ============================================
# ðŸ§± VOLUMENES DE NIVEL SUPERIOR
# ============================================
volumes: 
  pnpm_store:
    driver: local
